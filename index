<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Interactive Music Visualizer</title>
<style>
  html, body { margin: 0; padding: 0; overflow: hidden; background: black; }
  canvas { display: block; }
  #hint {
    position: fixed; bottom: 20px; left: 50%;
    transform: translateX(-50%); color: #fff;
    font-family: sans-serif; opacity: 0.6;
  }
</style>
</head>
<body>
<canvas id="c"></canvas>
<div id="hint">Click anywhere to start music • Move mouse to interact • Press 1-4 to change modes</div>
<script>
const canvas = document.getElementById('c');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
const mouse = { x: canvas.width / 2, y: canvas.height / 2, tx: canvas.width / 2, ty: canvas.height / 2 };
window.addEventListener('mousemove', e => { mouse.tx = e.clientX; mouse.ty = e.clientY; });
window.addEventListener('touchmove', e => {
  if(e.touches.length > 0){ mouse.tx = e.touches[0].clientX; mouse.ty = e.touches[0].clientY; }
}, { passive: true });
const particles = [];
const PARTICLE_COUNT = 300;
for(let i=0;i<PARTICLE_COUNT;i++){
  particles.push({
    x: Math.random()*canvas.width,
    y: Math.random()*canvas.height,
    r: Math.random()*3+1.5,
    vx: (Math.random()-0.5)*1.5,
    vy: (Math.random()-0.5)*1.5,
    hue: Math.random()*360,
    phase: Math.random()*Math.PI*2
  });
}
let waveOffset = 0;
let mode = 'attract'; // attract, repel, orbit
// Audio setup
const audio = new Audio('music.mp3');
audio.loop = true;
let analyser, data;
const startAudio = () => {
  const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
  const src = audioCtx.createMediaElementSource(audio);
  analyser = audioCtx.createAnalyser();
  analyser.fftSize = 512;
  data = new Uint8Array(analyser.frequencyBinCount);
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
  audio.play();
  window.removeEventListener('click', startAudio);
};
window.addEventListener('click', startAudio);
window.addEventListener('keydown', e => {
  if(e.key === '1') mode = 'attract';
  if(e.key === '2') mode = 'repel';
  if(e.key === '3') mode = 'orbit';
  if(e.key === '4') mode = 'wave';
});
function animate(){
  ctx.fillStyle = 'rgba(0,0,0,0.1)';
  ctx.fillRect(0,0,canvas.width,canvas.height);
  
  // Smooth mouse following
  mouse.x += (mouse.tx - mouse.x) * 0.6;
  mouse.y += (mouse.ty - mouse.y) * 0.6;
  
  let energy = 0, bass = 0, treble = 0;
  if(analyser){
    analyser.getByteFrequencyData(data);
    energy = data.reduce((a,b)=>a+b)/data.length;
    bass = data.slice(0,10).reduce((a,b)=>a+b)/10;
    treble = data.slice(-20).reduce((a,b)=>a+b)/20;
  }
  
  waveOffset += 0.05 + energy * 0.001;
  
  // Draw frequency bars
  if(analyser){
    const barW = canvas.width / data.length;
    for(let i=0; i<data.length; i++){
      const h = data[i] / 255 * 100;
      const hue = (i / data.length * 360 + waveOffset * 10) % 360;
      ctx.fillStyle = `hsla(${hue},100%,60%,0.3)`;
      ctx.fillRect(i * barW, canvas.height - h, barW - 1, h);
    }
  }
  
  for(let p of particles){
    const dx = mouse.x - p.x;
    const dy = mouse.y - p.y;
    const dist = Math.sqrt(dx*dx + dy*dy) || 1;
    
    if(mode === 'attract'){
      const pull = Math.min(100/dist,2);
      p.vx += dx/dist * pull * 0.15;
      p.vy += dy/dist * pull * 0.15;
    } else if(mode === 'repel'){
      const push = Math.min(5000/(dist*dist),5);
      p.vx -= dx/dist * push * 0.1;
      p.vy -= dy/dist * push * 0.1;
    } else if(mode === 'orbit'){
      const force = 0.5;
      p.vx += -dy/dist * force;
      p.vy += dx/dist * force;
    } else if(mode === 'wave'){
      p.y += Math.sin(p.x * 0.01 + waveOffset) * bass * 0.02;
    }
    
    // Bass pulse effect
    p.vx += (Math.random()-0.5) * bass * 0.003;
    p.vy += (Math.random()-0.5) * bass * 0.003;
    
    p.x += p.vx; p.y += p.vy;
    p.vx *= 0.92; p.vy *= 0.92;
    
    // Wrap around edges
    if(p.x < 0) p.x = canvas.width;
    if(p.x > canvas.width) p.x = 0;
    if(p.y < 0) p.y = canvas.height;
    if(p.y > canvas.height) p.y = 0;
    
    p.phase += 0.05;
    p.hue += 0.5 + energy*0.02;
    
    const pulse = Math.sin(p.phase) * 0.5 + 0.5;
    const size = p.r + energy*0.03 + bass*0.05;
    
    // Draw particle with glow
    ctx.shadowBlur = 15 + treble * 0.2;
    ctx.shadowColor = `hsl(${p.hue},100%,60%)`;
    ctx.beginPath();
    ctx.fillStyle = `hsl(${p.hue},100%,${50 + pulse*20}%)`;
    ctx.arc(p.x,p.y,size,0,Math.PI*2);
    ctx.fill();
    ctx.shadowBlur = 0;
    
    // Draw connections
    for(let q of particles){
      const d = Math.hypot(p.x - q.x, p.y - q.y);
      if(d < 100){
        const opacity = (1 - d/100) * 0.3;
        ctx.strokeStyle = `hsla(${(p.hue+q.hue)/2},100%,60%,${opacity})`;
        ctx.lineWidth = 0.5 + energy * 0.01;
        ctx.beginPath();
        ctx.moveTo(p.x,p.y);
        ctx.lineTo(q.x,q.y);
        ctx.stroke();
      }
    }
  }
  
  // Mode indicator
  ctx.fillStyle = 'rgba(255,255,255,0.5)';
  ctx.font = '14px sans-serif';
  ctx.fillText(`Mode: ${mode.toUpperCase()} | Press 1-4 to change`, 20, 30);
  
  requestAnimationFrame(animate);
}
animate();
</script>
</body>
</html>


